# v0.6.0 Corporate Actions Engine - Playwright MCP Test Checklist

> **Purpose**: Comprehensive UI testing checklist for the v0.6.0 Corporate Actions Engine using Playwright MCP tools
> **Target Agent**: Next agent handling UI/UX validation
> **Status**: Ready for execution

## Prerequisites

### Test Environment Setup
- [ ] Server running: `just server bg` or `just dev`
- [ ] Navigate to: `http://localhost:4000/corporate-actions`
- [ ] Ensure test data exists (symbols: AAPL, MSFT, GOOGL, SPY, VTI, TSLA, NVDA, BTC-USD)

### Browser Tools Required
- `mcp__playwright__browser_navigate`
- `mcp__playwright__browser_snapshot`
- `mcp__playwright__browser_click`
- `mcp__playwright__browser_select_option`
- `mcp__playwright__browser_type`
- `mcp__playwright__browser_fill_form`
- `mcp__playwright__browser_take_screenshot`

## Test Scenarios

### 1. Corporate Actions Index Page

#### 1.1 Page Load and Navigation
- [ ] Navigate to `/corporate-actions`
- [ ] Verify page title: "Corporate Actions · Ashfolio"
- [ ] Confirm heading: "Corporate Actions"
- [ ] Check subtitle: "Manage stock splits, dividends, and other corporate actions"
- [ ] Verify "New Corporate Action" button is present and clickable

#### 1.2 Filter Functionality
- [ ] Click "All (0)" filter button
- [ ] Click "Pending" filter button
- [ ] Click "Applied" filter button
- [ ] Click "Reversed" filter button
- [ ] Verify active filter styling changes (blue background for selected)

#### 1.3 Empty State
- [ ] Confirm "No corporate actions found" message displays
- [ ] Verify empty state icon is present
- [ ] Check appropriate message based on filter: "Get started..." vs "No actions match..."

### 2. New Corporate Action Form

#### 2.1 Form Modal Opening
- [ ] Click "New Corporate Action" button
- [ ] Verify modal overlay appears with backdrop
- [ ] Confirm modal title: "New Corporate Action"
- [ ] Check close button (X) is functional
- [ ] Verify clicking backdrop closes modal

#### 2.2 Form Field Validation
- [ ] Test all required fields show validation errors when empty
- [ ] Verify "Action Type *" field is required
- [ ] Verify "Symbol *" field is required
- [ ] Verify "Ex-Date *" field is required
- [ ] Check description field accepts input (optional)

#### 2.3 Action Type Conditional Logic (CRITICAL TEST)

##### Stock Split Selection
- [ ] Select "Stock Split" from action type dropdown
- [ ] Verify "Stock Split Details" section appears
- [ ] Check "Split Ratio From" field is visible with placeholder "1"
- [ ] Check "Split Ratio To" field is visible with placeholder "2"
- [ ] Verify help text: "For a 2:1 split (1 share becomes 2), enter From: 1, To: 2"

##### Cash Dividend Selection
- [ ] Select "Cash Dividend" from action type dropdown
- [ ] Verify "Dividend Details" section appears
- [ ] Check "Dividend Amount" field is visible with placeholder "1.00"
- [ ] Check "Currency" dropdown defaults to "USD"
- [ ] Verify "Qualified Dividend" checkbox is present

##### Stock Dividend Selection
- [ ] Select "Stock Dividend" from action type dropdown
- [ ] Verify same dividend fields appear as cash dividend
- [ ] Confirm currency options: USD, CAD, EUR, GBP

##### Merger Selection
- [ ] Select "Merger" from action type dropdown
- [ ] Verify appropriate fields appear (exchange ratio, cash consideration)
- [ ] Test conditional merger type fields

##### Spinoff Selection
- [ ] Select "Spinoff" from action type dropdown
- [ ] Verify spinoff-specific fields appear
- [ ] Check for new symbol selection field

##### Return of Capital Selection
- [ ] Select "Return of Capital" from action type dropdown
- [ ] Verify dividend amount field appears (required for this type)

### 3. Form Submission Testing

#### 3.1 Stock Split Form Submission
```javascript
// Test data for agent to use:
{
  action_type: "stock_split",
  symbol_id: "AAPL - Apple Inc.",
  ex_date: "2024-06-01",
  description: "2:1 stock split test",
  split_ratio_from: "1",
  split_ratio_to: "2"
}
```
- [ ] Fill form with above test data
- [ ] Click "Create Corporate Action" button
- [ ] Verify form submits successfully
- [ ] Check for success message: "Corporate action created successfully"
- [ ] Confirm redirect back to index page
- [ ] Verify new action appears in table

#### 3.2 Cash Dividend Form Submission
```javascript
// Test data for agent to use:
{
  action_type: "cash_dividend",
  symbol_id: "MSFT - Microsoft Corporation",
  ex_date: "2024-06-15",
  description: "$1.00 quarterly dividend",
  dividend_amount: "1.00",
  dividend_currency: "USD",
  qualified_dividend: true
}
```
- [ ] Fill form with above test data
- [ ] Submit and verify success
- [ ] Check dividend appears in actions table

#### 3.3 Merger Form Submission
```javascript
// Test data for agent to use:
{
  action_type: "merger",
  symbol_id: "GOOGL - Alphabet Inc.",
  ex_date: "2024-07-01",
  description: "Stock-for-stock merger test",
  exchange_ratio: "1.5"
}
```
- [ ] Fill form with above test data
- [ ] Submit and verify success
- [ ] Check merger appears in actions table

#### 3.4 Spinoff Form Submission
```javascript
// Test data for agent to use:
{
  action_type: "spinoff",
  symbol_id: "TSLA - Tesla, Inc.",
  new_symbol_id: "NEWCO - New Company", // May need to create symbol first
  ex_date: "2024-08-01",
  description: "1:1 spinoff test",
  exchange_ratio: "1"
}
```
- [ ] Fill form with above test data
- [ ] Submit and verify success
- [ ] Check spinoff appears in actions table

### 4. Actions Table Functionality

#### 4.1 Table Display
- [ ] Verify table headers: Symbol, Type, Description, Ex-Date, Status, Actions
- [ ] Check data displays correctly for each corporate action
- [ ] Verify action type formatting (e.g., "Stock Split", "Cash Dividend")
- [ ] Confirm date formatting (YYYY-MM-DD)
- [ ] Check status badges with appropriate colors

#### 4.2 Action Buttons (For Pending Actions)
- [ ] Verify "Preview" button appears for pending actions
- [ ] Check "Apply" button appears for pending actions
- [ ] Test "Apply" button shows confirmation dialog
- [ ] Verify "Edit" link is functional
- [ ] Check "Delete" button shows confirmation dialog

#### 4.3 Applied Actions
- [ ] Verify "Reverse" button appears for applied actions
- [ ] Test "Reverse" button shows confirmation dialog
- [ ] Check applied actions show applied timestamp
- [ ] Verify applied_by field displays correctly

### 5. Form Validation Edge Cases

#### 5.1 Required Field Validation
- [ ] Submit form with missing action type → error
- [ ] Submit form with missing symbol → error
- [ ] Submit form with missing ex-date → error
- [ ] Submit stock split without ratios → error
- [ ] Submit dividend without amount → error

#### 5.2 Business Logic Validation
- [ ] Test negative split ratios → error
- [ ] Test zero dividend amounts → error
- [ ] Test future ex-dates for applied actions → error
- [ ] Test merger without exchange ratio or cash → error

#### 5.3 Field Format Validation
- [ ] Test invalid date formats
- [ ] Test non-numeric values in numeric fields
- [ ] Test extremely large numbers
- [ ] Test decimal precision limits

### 6. UI/UX Quality Checks

#### 6.1 Visual Consistency
- [ ] Verify consistent button styling across forms
- [ ] Check modal responsive behavior
- [ ] Confirm proper spacing and alignment
- [ ] Verify color scheme matches app branding

#### 6.2 Accessibility Testing
- [ ] Tab through form elements (keyboard navigation)
- [ ] Check form labels are properly associated
- [ ] Verify button states (enabled/disabled/loading)
- [ ] Test screen reader compatibility (aria labels)

#### 6.3 Error State Handling
- [ ] Verify error messages are clear and actionable
- [ ] Check error styling (red borders, error text)
- [ ] Confirm errors clear when fields are corrected
- [ ] Test server error handling and display

### 7. Performance and Loading States

#### 7.1 Form Performance
- [ ] Measure form submission time (<2s expected)
- [ ] Check for loading states during submission
- [ ] Verify no UI freezing during processing
- [ ] Test rapid form interactions (type-ahead, selections)

#### 7.2 Page Loading
- [ ] Measure initial page load time
- [ ] Check for progressive loading indicators
- [ ] Verify data loads without flash of empty content
- [ ] Test navigation performance between pages

### 8. Integration Testing

#### 8.1 End-to-End Workflows
- [ ] Create stock split → verify in table → apply → check status
- [ ] Create dividend → edit details → save changes → verify updates
- [ ] Create multiple actions → test batch operations
- [ ] Apply action → reverse → verify audit trail

#### 8.2 Data Persistence
- [ ] Refresh page after creating action → verify data persists
- [ ] Navigate away and back → confirm state maintained
- [ ] Test browser back/forward buttons
- [ ] Verify deep linking to specific actions

## JavaScript Console Monitoring

### Expected Console Messages
- [ ] No JavaScript errors during normal operation
- [ ] Phoenix LiveView mount/update messages (normal)
- [ ] Successful form validation messages
- [ ] No 404s or resource loading failures

### Error Conditions to Watch For
- [ ] "Cannot read properties of null" errors
- [ ] Form validation JavaScript failures
- [ ] Phoenix LiveView connection errors
- [ ] CSS/asset loading failures

## Test Data Setup Commands

### Pre-populate Test Symbols (if needed)
```elixir
# Run in IEx console if symbols missing:
Ashfolio.SQLiteHelpers.get_or_create_symbol("TEST", %{name: "Test Corporation"})
Ashfolio.SQLiteHelpers.get_or_create_symbol("NEWCO", %{name: "New Company Spinoff"})
```

### Clean Test Data (after testing)
```elixir
# Clean up test corporate actions:
Ashfolio.Portfolio.CorporateAction.read!()
|> Enum.filter(&(&1.description =~ "test"))
|> Enum.each(&Ashfolio.Portfolio.CorporateAction.destroy/1)
```

## Expected Test Results

### Success Criteria
- [ ] All form submissions work without errors
- [ ] Conditional field logic functions correctly
- [ ] Data persistence works across page reloads
- [ ] No JavaScript console errors
- [ ] UI responsive and accessible
- [ ] Performance within acceptable limits (<2s form submission)

### Failure Investigation
- [ ] Screenshot failures for documentation
- [ ] Check browser console for error details
- [ ] Verify server logs for backend issues
- [ ] Test in multiple browsers if issues persist

## Notes for Testing Agent

1. **Critical Feature**: The conditional form fields (showing different fields based on action type) are the core new functionality - test thoroughly
2. **Form Validation Fix**: This was a major bug fix, so test form submission extensively
3. **Performance**: The M&A calculations should be fast (<100ms) - monitor for delays
4. **Error Handling**: Test edge cases and invalid inputs to ensure graceful failure
5. **Screenshots**: Take screenshots of successful form submissions for documentation

## Test Execution Commands for Agent

```javascript
// Navigate and start testing
await page.goto('http://localhost:4000/corporate-actions');

// Take initial screenshot
await page.screenshot({ path: 'corporate-actions-index.png', fullPage: true });

// Click new action button
await page.click('text=New Corporate Action');

// Fill and submit stock split form
await page.selectOption('select[name="form[action_type]"]', 'stock_split');
await page.selectOption('select[name="form[symbol_id]"]', 'aapl_id'); // Use actual ID
await page.fill('input[name="form[ex_date]"]', '2024-06-01');
await page.fill('input[name="form[description]"]', '2:1 stock split test');
await page.fill('input[name="form[split_ratio_from]"]', '1');
await page.fill('input[name="form[split_ratio_to]"]', '2');
await page.click('text=Create Corporate Action');
```

This checklist should provide comprehensive coverage for validating the v0.6.0 Corporate Actions Engine UI functionality using Playwright MCP tools.