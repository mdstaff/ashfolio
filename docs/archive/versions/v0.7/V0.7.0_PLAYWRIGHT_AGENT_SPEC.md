# v0.7.0 Playwright MCP Testing Agent Specification

> Purpose: Specialized agent for comprehensive UI testing of v0.7.0 Advanced Portfolio Analytics using Playwright MCP tools
> Agent Type: `playwright-ui-tester`
> Primary Focus: Efficient Frontier visualization and mathematical validation

## Agent Overview

### Capabilities Required

- Browser Automation: Full Playwright MCP tool suite for web testing
- Mathematical Validation: Ability to extract and validate numerical data
- Visual Documentation: Screenshot capture and visual regression detection
- Error Detection: Console monitoring and JavaScript error tracking

### Target Features

- Efficient Frontier Analysis (flagship v0.7.0 feature)
- Portfolio optimization display (3 optimal portfolios)
- Mathematical accuracy validation
- Integration with existing analytics
- Real-time updates and caching

## Critical Test Scenarios

### 1. Efficient Frontier Flagship Test

Goal: Validate the core v0.7.0 feature works perfectly

Key Validations:

- ✅ Three portfolio cards appear (blue/green/purple)
- ✅ Proper card positioning and animation
- ✅ No JavaScript console errors

### 2. Mathematical Accuracy Validation

Goal: Ensure financial calculations are mathematically sound

Key Validations:

- ✅ Tangency portfolio has highest Sharpe ratio
- ✅ Min variance has lowest volatility
- ✅ Portfolio weights sum to 100% (±0.01%)
- ✅ Risk-return ordering correct

## Test Execution Protocol

### Pre-Test Setup

1. Environment Verification

```bash
just server bg  # Start background server
curl -f http://localhost:4000/health  # Verify server health
```

2. Test Data Requirements

- Portfolio with at least 3 different asset types (STOCK, BOND, REIT)
- Sufficient transaction history for TWR/MWR calculations

3. Playwright MCP tool | Browser Initialization

### Test Execution Sequence

#### Phase 1: Baseline Validation

1. Navigate to Advanced Analytics page
2. Verify page loads correctly with all cards present
3. Take initial screenshot: `advanced-analytics-initial.png`
4. Verify no JavaScript errors in console

#### Phase 2: Efficient Frontier Core Testing

2. Visual Test: Verify three portfolio cards appear
3. Data Test: Extract and validate numerical values
4. Mathematical Test: Verify optimization relationships
5. Take screenshot: `efficient-frontier-results.png`

#### Phase 3: Integration Testing

1. Refresh All Test: Execute batch calculation
2. Cache Test: Verify caching behavior
3. History Test: Check calculation appears in history
4. PubSub Test: Create transaction and verify updates

#### Phase 4: Edge Case Testing

2. Error Handling: Invalid data scenarios
3. Responsive Design: Multiple viewport sizes
4. Accessibility: Keyboard navigation

### Success Criteria Matrix

#### Mathematical Validation Requirements

- ✅ Correct Sharpe ratios calculated and displayed
- ✅ Portfolio weights sum to 100% (±0.01% tolerance)
- ✅ Risk-return ordering follows optimization logic
- **Validation Method:** JavaScript data extraction and numerical verification

#### Visual Presentation Requirements

- ✅ Color coding system (blue/green/purple) properly applied
- ✅ Portfolio cards positioned correctly with proper spacing
- ✅ Smooth animations during calculation and display phases
- **Validation Method:** Screenshot comparison and visual regression testing

#### Integration Functionality Requirements

- ✅ Calculation history updates automatically with new results
- ✅ PubSub system provides real-time synchronization across components

### Error Handling Protocol

#### JavaScript Errors

```javascript
page.on("console", (msg) => {
  if (msg.type() === "error") {
    console.error("Page error:", msg.text());
  }
});

const errors = await page.evaluate(() => window.errors || []);
assert(errors.length === 0, `Found ${errors.length} JavaScript errors`);
```

#### Network Failures

```javascript
page.on("response", (response) => {
  if (response.status() >= 400) {
    console.warn(`HTTP ${response.status()}: ${response.url()}`);
  }
});
```

#### Timeout Handling

- Default timeout: 5 seconds for calculations
- Extended timeout: 10 seconds for "Refresh All"
- Cache hit timeout: 1 second maximum

### Documentation Requirements

#### Screenshots Needed

1. `advanced-analytics-initial.png` - Clean page load
2. `efficient-frontier-calculating.png` - Loading state
3. `efficient-frontier-results.png` - Complete results
4. `portfolio-cards-detail.png` - Close-up of cards
5. `mathematical-validation.png` - Console validation output
6. `integration-complete.png` - Full dashboard state

#### Mathematical Results to Validate

- Minimum Variance Portfolio: Return %, Volatility %, Weights
- Tangency Portfolio: Return %, Volatility %, Sharpe Ratio, Weights
- Maximum Return Portfolio: Return %, Volatility %, Weights
- Weight summation verification (100% ± 0.01%)
- Risk-return ordering validation

## Agent Completion Criteria

### Test Execution Complete When:

- [ ] All 15 test sections completed successfully
- [ ] All mathematical validations pass
- [ ] Screenshots captured with proper naming
- [ ] Console shows zero JavaScript errors
- [ ] Integration points verified working
- [ ] Final assessment document populated

### Deliverables Expected:

1. Completed Test Checklist: All checkboxes marked
2. Coverage Assessment: Filled with actual results
3. Screenshot Collection: 7+ images documenting functionality
4. Issue Log: Any problems discovered during testing
5. Mathematical Validation: Proof that optimization is correct

## Risk Mitigation

### High-Risk Areas to Monitor:

1. Calculation Failures: Optimization algorithms may fail with edge cases
2. Cache Corruption: Invalid cache states could cause incorrect results
3. Integration Breaks: Changes to existing analytics could affect new features

### Fallback Strategies:

1. Graceful Degradation: Verify error messages are user-friendly
2. Manual Verification: Cross-check mathematical results with known formulas
3. Isolation Testing: Test Efficient Frontier independently if integration fails

---

This specification provides a comprehensive framework for automated testing of the v0.7.0 Efficient Frontier feature using Playwright MCP tools, ensuring both functional correctness and mathematical accuracy.
